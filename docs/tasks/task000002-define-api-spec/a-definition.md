# タスク定義ドキュメント

<!--
このドキュメントについて:
  - 格納場所: docs/tasks/task000002-define-api-spec/a-definition.md
  - 作成方法: /b-001-CreateTaskDefinition ワークフローで作成
  - 関連ドキュメント:
    - b-research.md (リサーチドキュメント)
    - c-implementation.md (実装タスクリスト)
-->

---

## 1. 目的

| 項目         | 内容                                                                                                                                                 |
| ------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------- |
| 解決する問題 | フロントエンドとバックエンドの実装を進めるにあたり、明確な通信規約（API仕様）が存在しないため、並行開発や結合が困難である。                          |
| 提供する価値 | ドメインモデルに基づいたREST API仕様を策定することで、フロントエンド・バックエンド間のインターフェースを確定させ、スムーズな実装と結合を可能にする。 |

---

## 2. ユーザーストーリー一覧

| ID     | ユーザーストーリー                                                                           | 優先度 | 備考                              |
| ------ | -------------------------------------------------------------------------------------------- | ------ | --------------------------------- |
| US-001 | 社会人（自習者）として、WikipediaのURLを入力して、その記事のサマリと○×問題を生成したい       | High   | `POST /api/materials`             |
| US-003 | 社会人（自習者）として、生成された○×問題に回答して、即座に正解・不正解を知りたい             | High   | `POST /api/sessions/{id}/answers` |
| US-005 | 社会人（自習者）として、全問回答後に学習結果（正答数）を確認したい                           | High   | `GET /api/sessions/{id}/result`   |
| US-007 | 社会人（自習者）として、パスワード認証を行い、許可されたユーザーのみが利用できるようにしたい | High   | `POST /api/auth/login`            |

---

## 3. 受け入れ基準

| ID     | 受け入れ基準                                                                        | 検証方法                     |
| ------ | ----------------------------------------------------------------------------------- | ---------------------------- |
| AC-001 | ドメインモデルのすべてのCommandとQueryをカバーするAPIエンドポイントが定義されている | 仕様書とドメインモデルの突合 |
| AC-002 | リクエストとレスポンスのデータ構造（JSONスキーマ）が明確になっている                | 仕様書の確認                 |
| AC-003 | エラーハンドリング（4xx, 5xx）とステータスコードのルールが定義されている            | 仕様書の確認                 |
| AC-004 | `docs/project/04-design/05-api-spec.md` が作成されている                            | ファイル存在確認             |

---

## 4. 影響範囲

| コンポーネント | 影響内容                                                |
| -------------- | ------------------------------------------------------- |
| フロントエンド | APIクライアントの実装、型定義の作成に影響               |
| バックエンド   | API Routeハンドラーの実装、バリデーションロジックに影響 |
| ドキュメント   | `docs/project/04-design/05-api-spec.md` の新規作成      |

---

## 実装結果

**実装日**: 2025-11-21

**実装内容**:

- `docs/project/04-design/05-api-spec.md` の作成完了
- 認証API（`POST /api/auth/login`, `POST /api/auth/logout`, `GET /api/auth/me`）の仕様定義
- 教材生成API（`POST /api/materials`）の仕様定義
- 学習セッションAPI（`POST /api/sessions`, `POST /api/sessions/{id}/answers`, `GET /api/sessions/{id}/result`）の仕様定義
- 共通仕様（ベースURL、認証方式、エラーレスポンス形式）の策定
- ドメインモデルとの整合性確認完了

**検証結果**:

- ✅ ドメインモデルのすべてのCommandとQueryがAPIエンドポイントでカバーされている
- ✅ リクエスト/レスポンスのJSONスキーマが明確に定義されている
- ✅ エラーハンドリング（4xx, 5xx）とステータスコードのルールが定義されている
- ✅ `docs/project/04-design/05-api-spec.md` が作成されている

**変更差異**:

- 当初は `docs/project/05-api/01-api-spec.md` に配置予定だったが、設計ドキュメントとして `docs/project/04-design/05-api-spec.md` に配置
- 計画通りに全APIエンドポイントを定義完了

---

## メモ

- API仕様が確定したことで、フロントエンド・バックエンドの並行開発が可能になった
- 次のタスク（コア機能実装）でこのAPI仕様に基づいた実装を行う
