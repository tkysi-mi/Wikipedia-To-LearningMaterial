# リサーチドキュメント

<!--
このドキュメントについて:
  - 格納場所: docs/tasks/task000004-deploy-to-railway/b-research.md
  - 作成方法: /b-002-CreateTaskResearch ワークフローで作成
  - 前提条件: a-definition.md が作成済みであること
-->

---

## 1. ベストプラクティス

| トピック         | ベストプラクティス                                                                                                                                   | 参考リンク                                                                                            |
| ---------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------- |
| Railway デプロイ | GitHub リポジトリと連携して自動デプロイを設定するのが一般的。CLI からのデプロイも可能だが、CI/CD の観点からは GitHub 連携が推奨される。              | [Railway Docs - GitHub Repo](https://docs.railway.com/guides/github-repo)                             |
| 環境変数管理     | 機密情報（APIキーなど）は Railway のダッシュボードまたは CLI で設定し、リポジトリには含めない。                                                      | [Railway Docs - Variables](https://docs.railway.com/guides/variables)                                 |
| Next.js 設定     | Standalone モードを有効にすると、Docker イメージサイズを削減できる。Railway は自動的にこれを検知する場合があるが、明示的に設定することも推奨される。 | [Next.js Docs - Output Standalone](https://nextjs.org/docs/pages/api-reference/next-config-js/output) |

---

## 2. 既存コードの調査

| 項目             | 内容                                                                                                                |
| ---------------- | ------------------------------------------------------------------------------------------------------------------- |
| 類似機能の有無   | なし（初のデプロイタスク）                                                                                          |
| 既存実装パターン | `package.json` の `scripts` に `build` と `start` が定義されており、標準的な Next.js のビルドプロセスに従っている。 |
| 改善すべき点     | `next.config.mjs` に `output: 'standalone'` の設定がない可能性があるため、確認が必要。                              |

---

## 3. 再利用可能なコンポーネント

特になし（インフラタスクのため）

---

## 4. 技術選定

| 技術・ライブラリ | 選定理由                                                                                      | 代替案との比較                                                                                         |
| ---------------- | --------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------ |
| Railway          | 設定が容易で、Next.js のホスティングに適している。PostgreSQL などのアドオンも簡単に追加可能。 | Vercel は Next.js に最適だが、商用利用時の制限やコスト構造が異なる。Railway はインフラの柔軟性が高い。 |

---

## 5. 技術的リスクと制約

| リスク           | 影響                           | 軽減策                                                                                                                 |
| ---------------- | ------------------------------ | ---------------------------------------------------------------------------------------------------------------------- |
| ビルド失敗       | デプロイが完了しない           | ローカルでのビルド (`npm run build`) が成功することを確認済み。Railway 上での Node.js バージョンをローカルと合わせる。 |
| 環境変数の漏洩   | セキュリティ事故               | `.env` ファイルをコミットしない。Railway の環境変数設定機能を正しく使用する。                                          |
| コールドスタート | アプリケーションの起動が遅れる | Railway は常時起動が基本だが、プランによってはスリープする場合がある（要確認）。                                       |

---

## メモ

- **Railway CLI ログイン**: デプロイ作業には Railway CLI へのログイン (`railway login`) が必要。
- **プロジェクト作成**: `railway init` または `railway link` でプロジェクトをリンクする。
- **デプロイコマンド**: `railway up` でデプロイ可能。
- **環境変数**:
  - `AUTH_PASSWORD`
  - `OPENAI_API_KEY`
  - `NEXT_PUBLIC_APP_URL` (本番 URL)
