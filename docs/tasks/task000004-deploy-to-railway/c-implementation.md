# 実装タスクリスト

<!--
このドキュメントについて:
  - 格納場所: docs/tasks/task000004-deploy-to-railway/c-implementation.md
  - 作成方法: /b-003-CreateTaskImplementation ワークフローで作成
-->

---

## フェーズ 1: Railway プロジェクトと GitHub 連携のセットアップ

**目的:** Railway 上にプロジェクトを作成し、GitHub リポジトリと連携して自動デプロイを設定する。

**完了条件:** GitHub への push 時に自動的に Railway でビルド・デプロイが開始されること。

### ステップ

- [x] **Railway ダッシュボードでプロジェクトを作成** <!-- id: 1 -->
  - 操作: Railway ダッシュボード (https://railway.com) にアクセス
  - 変更内容:
    - "New Project" をクリック
    - "Deploy from GitHub repo" を選択
    - リポジトリ `tkysi-mi/Wikipedia-To-LearningMaterial` を選択
    - ブランチ `main` を選択
  - 検証: プロジェクトが作成され、サービスが表示されること。

- [x] **環境変数の設定** <!-- id: 2 -->
  - 操作: Railway ダッシュボード → プロジェクト → サービス → Variables
  - 変更内容: 以下の環境変数を設定する。
    - `AUTH_PASSWORD`: (ローカルの .env.local から取得)
    - `OPENAI_API_KEY`: (ローカルの .env.local から取得)
    - `NPM_FLAGS`: `--legacy-peer-deps`
  - 検証: Variables タブで設定された変数を確認。

---

## フェーズ 2: アプリケーションのデプロイと公開

**目的:** アプリケーションを自動ビルドし、Railway 上で稼働させる。

**完了条件:** デプロイが成功し、公開 URL からアプリケーションにアクセスできること。

### ステップ

- [x] **初回デプロイの実行** <!-- id: 3 -->
  - 操作: Railway が自動的にビルドを開始
  - 変更内容: GitHub リポジトリの最新コミットから自動デプロイ
  - 検証: Deployments タブでビルドログを確認し、エラーがないこと。

- [x] **公開ドメインの生成** <!-- id: 4 -->
  - 操作: Railway ダッシュボード → サービス → Settings → Networking
  - 変更内容: "Generate Domain" をクリックして公開 URL を生成
  - 検証: 生成されたドメイン (例: https://xxx.up.railway.app) が表示されること。

- [x] **環境変数 NEXT_PUBLIC_APP_URL の設定** <!-- id: 5 -->
  - 操作: Railway ダッシュボード → Variables
  - 変更内容: 生成されたドメインを `NEXT_PUBLIC_APP_URL` として追加
  - 検証: 変数が設定され、自動的に再デプロイが開始されること。

---

## フェーズ 3: 動作検証

**目的:** 本番環境での動作を確認する。

**完了条件:** ログイン、教材生成、クイズ機能が正常に動作すること。

### ステップ

- [x] **ログイン機能の検証** <!-- id: 6 -->
  - 検証: 公開 URL にアクセスし、設定したパスワードでログインできること。

- [x] **教材生成機能の検証** <!-- id: 7 -->
  - 検証: Wikipedia の URL を入力し、教材生成が完了すること（OpenAI API が正しく呼ばれていること）。

- [x] **クイズ機能の検証** <!-- id: 8 -->
  - 検証: 生成されたクイズに回答し、フィードバックが表示されること。

- [ ] **自動デプロイの検証** <!-- id: 9 -->
  - 検証: GitHub に push して、Railway で自動的にデプロイが開始されることを確認。

---

## 受け入れ基準

### フェーズ 1 の受け入れ基準

- [x] Railway プロジェクトが GitHub リポジトリと連携されている
- [x] 必要な環境変数が全て設定されている

### フェーズ 2 の受け入れ基準

- [x] ビルドが成功する
- [x] アプリケーションが起動し、クラッシュしない
- [x] 公開 URL (HTTPS) でアクセスできる
- [x] NEXT_PUBLIC_APP_URL が正しく設定されている

### フェーズ 3 の受け入れ基準

- [x] ログインができる
- [x] 教材生成ができる
- [x] クイズができる
- [x] 日本語 UI が正しく表示される
- [ ] GitHub への push で自動デプロイされる

---

## メモ

- **GitHub 連携の利点**: コードの変更時に自動的にデプロイされるため、CI/CD パイプラインとして機能します。
- **Railway CLI**: CLI はローカルからのデプロイに使用できますが、GitHub 連携の設定はダッシュボードから行う必要があります。
- **環境変数の更新**: 環境変数を変更すると、自動的に再デプロイがトリガーされます。
